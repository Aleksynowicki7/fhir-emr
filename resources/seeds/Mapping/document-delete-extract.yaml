body:
    $let:
        reference: $ fhirpath("Provenance.target").0
        qrId: $ fhirpath("QuestionnaireResponse.id")
        qrVersion: $ fhirpath("QuestionnaireResponse.meta.versionId")
        qrLastUpdated: >-
            $ fhirpath("QuestionnaireResponse.meta.lastUpdated") || fhirpath("QuestionnaireResponse.repeat(item).where(linkId='dateTime').answer.value.dateTime").0
        practitioner: $ Practitioner
    $body:
        type: transaction
        entry:
            - request:
                  url: $ "/" + reference.resourceType + "/" + reference.id
                  method: PATCH
              resource:
                  resourceType: $ reference.resourceType
                  status: entered-in-error
            - request:
                  url: /Provenance
                  method: POST
              resource:
                  resourceType: Provenance
                  target:
                      - id: $ reference.id
                        resourceType: $ reference.resourceType
                  recorded: $ qrLastUpdated
                  activity:
                      coding:
                          - code: 'DELETE'
                            display: 'delete'
                            system: 'http://terminology.hl7.org/CodeSystem/v3-DataOperation'
                  agent:
                      - who:
                            id: $ practitioner.id
                            resourceType: $ practitioner.resourceType
                            display: $ practitioner.name.0.given.0 + ' ' + practitioner.name.0.family
                  entity:
                      - role: source
                        what:
                            uri: $ "QuestionnaireResponse/" + qrId + "/_history/" + qrVersion
        resourceType: Bundle
id: document-delete-extract
resourceType: Mapping
