resourceType: Mapping
id: practitioner-create
$let:
  practitionerId: $ fhirpath("QuestionnaireResponse.repeat(item).where(linkId='practitioner-id').answer.value.string").0
  practitionerRoleId: $ fhirpath("QuestionnaireResponse.repeat(item).where(linkId='practitioner-role-id').answer.value.string")
body:
  type: transaction
  entry:
    $call: concat
    $args:
      - - request:
            url: $ "/Practitioner/" + practitionerId
            method: PUT
          fullUrl: urn:uuid:practitioner-id
          resource:
            resourceType: Practitioner
            name:
              - given:
                  - $ fhirpath("QuestionnaireResponse.repeat(item).where(linkId='first-name').answer.value.string").0
                  - $ fhirpath("QuestionnaireResponse.repeat(item).where(linkId='middle-name').answer.value.string").0
                family: $ fhirpath("QuestionnaireResponse.repeat(item).where(linkId='last-name').answer.value.string").0
      - $map: $ fhirpath("QuestionnaireResponse.repeat(item).where(linkId='specialty').answer")
        $as: specialtyItem
        $body:
          request:
            url: /PractitionerRole
            method: PUT
          resource:
            specialty:
              - coding:
                  - $ specialtyItem.value.Coding
            resourceType: practitionerRole
            practitioner:
              uri: urn:uuid:practitioner-id
